<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Assets</title>
  <style>
    :root{
      --bg1:#05060a;
      --bg2:#0b0f1f;
      --card: rgba(255,255,255,.06);
      --card2: rgba(255,255,255,.09);
      --stroke: rgba(255,255,255,.10);
      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.62);
      --accent: #8b5cf6; /* 紫 */
      --accent2:#22d3ee; /* 青 */
      --shadow: 0 30px 80px rgba(0,0,0,.55);
      --radius: 22px;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "PingFang SC","Hiragino Sans GB","Microsoft YaHei", sans-serif;
      color:var(--text);
      background:
        radial-gradient(1200px 600px at 15% 20%, rgba(139,92,246,.25), transparent 55%),
        radial-gradient(1000px 520px at 85% 25%, rgba(34,211,238,.18), transparent 60%),
        radial-gradient(900px 520px at 50% 85%, rgba(244,114,182,.16), transparent 60%),
        linear-gradient(180deg, var(--bg1), var(--bg2));
      overflow-x:hidden;
    }

    /* 隐藏滚动条但可滚动 */
    .scroll{
      overflow:auto;
      -ms-overflow-style:none; /* IE */
      scrollbar-width:none;    /* Firefox */
    }
    .scroll::-webkit-scrollbar{width:0;height:0}

    a{color:inherit;text-decoration:none}
    .wrap{
      max-width: 1180px;
      margin: 0 auto;
      padding: 44px 18px 80px;
    }

    .top{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      margin-bottom: 24px;
    }
    .brand{
      display:flex;align-items:center;gap:12px;
    }
    .pill{
      display:inline-flex;align-items:center;gap:10px;
      padding: 8px 12px;
      border:1px solid var(--stroke);
      border-radius:999px;
      background: rgba(255,255,255,.05);
      backdrop-filter: blur(14px);
      box-shadow: 0 12px 50px rgba(0,0,0,.25);
      font-weight:600;
      font-size:13px;
    }
    .dot{
      width:8px;height:8px;border-radius:50%;
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      box-shadow: 0 0 18px rgba(139,92,246,.55);
    }
    .btn{
      display:inline-flex;align-items:center;gap:10px;
      padding: 10px 14px;
      border:1px solid var(--stroke);
      border-radius:999px;
      background: rgba(255,255,255,.06);
      backdrop-filter: blur(14px);
      cursor:pointer;
      font-weight:600;
      color:var(--text);
      transition:.15s ease;
      user-select:none;
    }
    .btn:hover{transform: translateY(-1px); background: rgba(255,255,255,.085)}
    .btn:active{transform: translateY(0px)}
    .btn .mini{opacity:.8;font-weight:700;font-size:12px}

    h1{
      margin: 10px 0 8px;
      font-size: 44px;
      line-height: 1.12;
      letter-spacing: -0.02em;
    }
    .sub{
      color: var(--muted);
      font-size: 14px;
      line-height: 1.65;
      max-width: 760px;
      margin-bottom: 16px;
    }

    .search{
      margin: 18px 0 26px;
      position:relative;
    }
    .search input{
      width:100%;
      padding: 16px 16px 16px 48px;
      border-radius: 999px;
      border: 1px solid var(--stroke);
      outline:none;
      background: rgba(255,255,255,.06);
      color: var(--text);
      backdrop-filter: blur(14px);
      box-shadow: 0 18px 60px rgba(0,0,0,.35);
      font-size: 14px;
    }
    .search input::placeholder{color: rgba(255,255,255,.45)}
    .search .icon{
      position:absolute;left:16px;top:50%;transform:translateY(-50%);
      width:18px;height:18px;opacity:.75;
    }
    .hint{
      margin-top:8px;
      color: rgba(255,255,255,.45);
      font-size: 12px;
    }

    .grid{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 18px;
    }
    @media (max-width: 980px){
      .grid{grid-template-columns: 1fr}
      h1{font-size: 36px}
    }

    .card{
      border-radius: var(--radius);
      border: 1px solid var(--stroke);
      background: linear-gradient(180deg, rgba(255,255,255,.07), rgba(255,255,255,.04));
      backdrop-filter: blur(16px);
      box-shadow: var(--shadow);
      overflow:hidden;
      position:relative;
    }
    .cardHead{
      padding: 16px 16px 10px;
      display:flex;align-items:flex-end;justify-content:space-between;
      gap:10px;
    }
    .title{
      font-size: 16px;
      font-weight: 800;
      letter-spacing: -0.01em;
    }
    .desc{
      font-size: 12px;
      color: rgba(255,255,255,.55);
      margin-top:4px;
    }

    /* 分类 Tabs */
    .tabs{
      display:flex;
      gap:8px;
      padding: 0 16px 12px;
      flex-wrap: wrap;
    }
    .tab{
      padding: 7px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.12);
      color: rgba(255,255,255,.75);
      font-size: 12px;
      font-weight: 700;
      cursor:pointer;
      transition:.15s;
    }
    .tab:hover{background: rgba(255,255,255,.07)}
    .tab.active{
      border-color: rgba(139,92,246,.55);
      background: rgba(139,92,246,.12);
      color: rgba(255,255,255,.92);
      box-shadow: 0 0 0 1px rgba(139,92,246,.18) inset;
    }

    .body{
      padding: 0 16px 16px;
    }
    .gallery{
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.18);
      padding: 12px;
    }

    .items{
      display:grid;
      grid-template-columns: repeat(4, minmax(0, 1fr));
      gap: 10px;
    }
    @media (max-width: 980px){
      .items{grid-template-columns: repeat(3, 1fr)}
    }
    @media (max-width: 520px){
      .items{grid-template-columns: repeat(2, 1fr)}
    }

    .item{
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.05);
      overflow:hidden;
      position:relative;
      cursor:pointer;
      transition:.15s ease;
      min-height: 90px;
    }
    .item:hover{transform: translateY(-1px); border-color: rgba(255,255,255,.18)}
    .thumb{
      width:100%;
      height: 92px;
      display:block;
      object-fit: cover;
      background: rgba(255,255,255,.03);
    }
    .meta{
      position:absolute;
      left:8px;right:8px;bottom:8px;
      display:flex;align-items:center;justify-content:space-between;gap:8px;
      pointer-events:none;
    }
    .name{
      max-width: 100%;
      font-size: 11px;
      padding: 6px 8px;
      border-radius: 999px;
      background: rgba(0,0,0,.35);
      border: 1px solid rgba(255,255,255,.10);
      color: rgba(255,255,255,.75);
      overflow:hidden;text-overflow:ellipsis;white-space:nowrap;
      backdrop-filter: blur(10px);
    }

    .empty{
      padding: 18px 12px;
      color: rgba(255,255,255,.55);
      font-size: 13px;
      text-align:center;
    }

    /* Toast */
    .toast{
      position: fixed;
      left: 50%;
      bottom: 18px;
      transform: translateX(-50%);
      padding: 10px 14px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.55);
      backdrop-filter: blur(14px);
      color: rgba(255,255,255,.88);
      font-size: 13px;
      opacity:0;
      pointer-events:none;
      transition:.22s ease;
      box-shadow: 0 18px 60px rgba(0,0,0,.45);
    }
    .toast.show{opacity:1; bottom: 26px}

    /* Modal */
    .modal{
      position:fixed; inset:0;
      background: rgba(0,0,0,.62);
      backdrop-filter: blur(10px);
      display:none;
      align-items:center;
      justify-content:center;
      padding: 18px;
      z-index: 50;
    }
    .modal.show{display:flex}
    .modalBox{
      width: min(980px, 100%);
      border-radius: 22px;
      border: 1px solid rgba(255,255,255,.14);
      background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.04));
      box-shadow: 0 30px 90px rgba(0,0,0,.6);
      overflow:hidden;
      position:relative;
    }
    .modalTop{
      display:flex;align-items:center;justify-content:space-between;gap:10px;
      padding: 12px 12px 10px 14px;
      border-bottom: 1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.18);
    }
    .modalTitle{
      font-size: 13px;
      color: rgba(255,255,255,.78);
      font-weight: 700;
      overflow:hidden;text-overflow:ellipsis;white-space:nowrap;
      max-width: 70%;
    }
    .modalActions{display:flex;gap:8px;align-items:center}
    .iconBtn{
      width: 38px;height: 34px;
      border-radius: 12px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      cursor:pointer;
      color: rgba(255,255,255,.9);
      transition:.15s;
    }
    .iconBtn:hover{background: rgba(255,255,255,.10)}
    .modalImgWrap{
      width:100%;
      max-height: 75vh;
      display:flex;align-items:center;justify-content:center;
      padding: 14px;
      background:
        radial-gradient(800px 350px at 20% 15%, rgba(139,92,246,.14), transparent 55%),
        radial-gradient(650px 320px at 80% 25%, rgba(34,211,238,.10), transparent 60%),
        rgba(0,0,0,.18);
    }
    .modalImg{
      max-width: 100%;
      max-height: 72vh;
      object-fit: contain;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.03);
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="top">
      <div class="brand">
        <span class="pill"><span class="dot"></span> assets <span class="mini">GitHub Pages</span></span>
      </div>
      <button class="btn" id="openRepoBtn">Open Repo</button>
    </div>

    <h1>你的资源库</h1>
    <div class="sub">
      深色渐变 + 玻璃卡片 + 分类浏览。点击图片：<b>放大预览</b>；再点“复制”：直接得到可用直链（GitHub Pages 链接）。
    </div>

    <div class="search">
      <svg class="icon" viewBox="0 0 24 24" fill="none">
        <path d="M10.5 18a7.5 7.5 0 1 1 0-15 7.5 7.5 0 0 1 0 15Z" stroke="rgba(255,255,255,.75)" stroke-width="2"/>
        <path d="M16.5 16.5 21 21" stroke="rgba(255,255,255,.75)" stroke-width="2" stroke-linecap="round"/>
      </svg>
      <input id="q" placeholder="搜索：分类 / 文件名（例如：people / avatar / logo / bg）" />
      <div class="hint">提示：你只需要按“子文件夹”分类（例如 avatars/people/…），页面会自动出现分类按钮。</div>
    </div>

    <div class="grid" id="cards"></div>
  </div>

  <div class="toast" id="toast">已复制链接</div>

  <div class="modal" id="modal">
    <div class="modalBox">
      <div class="modalTop">
        <div class="modalTitle" id="modalTitle">—</div>
        <div class="modalActions">
          <button class="iconBtn" id="copyBtn" title="复制直链">复制</button>
          <button class="iconBtn" id="openBtn" title="在新标签打开">打开</button>
          <button class="iconBtn" id="closeBtn" title="关闭">关闭</button>
        </div>
      </div>
      <div class="modalImgWrap">
        <img class="modalImg" id="modalImg" alt="" />
      </div>
    </div>
  </div>

  <script>
    // === 配置 ===
    const REPO_URL = (() => {
      // 自动从 Pages 地址推断 repo：https://USER.github.io/REPO/
      // 这里 fallback：当前页面来源 + pathname 无法直接得到 owner，给个按钮让你自己点也行
      // 所以按钮做成“当前站点的 repo root”（你可以改成实际仓库链接）
      return "https://github.com/" + location.hostname.split(".")[0] + "/assets";
    })();

    // Pages 上的图片直链：用站点 base + 相对路径
    function siteBase() {
      // /assets/ 或 /assets/index.html
      const p = location.pathname.replace(/index\.html$/,'');
      return location.origin + p.replace(/\/?$/,'/'); // 确保末尾 /
    }
    function toUrl(path){ return siteBase() + path.replace(/^\//,''); }

    // 显示 toast
    const toast = (msg) => {
      const t = document.getElementById("toast");
      t.textContent = msg;
      t.classList.add("show");
      clearTimeout(window.__toastTimer);
      window.__toastTimer = setTimeout(()=>t.classList.remove("show"), 1100);
    };

    async function copyText(text){
      try{
        await navigator.clipboard.writeText(text);
        toast("已复制链接");
      }catch(e){
        // fallback
        const ta = document.createElement("textarea");
        ta.value = text;
        document.body.appendChild(ta);
        ta.select();
        document.execCommand("copy");
        ta.remove();
        toast("已复制链接");
      }
    }

    function isImage(p){
      return /\.(png|jpg|jpeg|gif|webp|svg)$/i.test(p);
    }

    // index.json 结构：
    // {
    //   "avatars": { "people": ["avatars/people/a.jpg"], "anime":[...], "root":[...] },
    //   "icons": { ... },
    //   "photos": { ... }
    // }
    async function loadIndex(){
      const res = await fetch("./index.json?_=" + Date.now(), {cache:"no-store"});
      if(!res.ok) throw new Error("index.json not found");
      return await res.json();
    }

    const state = {
      data: null,
      query: "",
      active: {
        avatars: null,
        icons: null,
        photos: null
      }
    };

    function norm(s){ return (s||"").toLowerCase(); }

    function categoriesOf(section){
      const obj = state.data?.[section] || {};
      const keys = Object.keys(obj).sort((a,b)=>{
        if(a==="root") return -1;
        if(b==="root") return 1;
        return a.localeCompare(b);
      });
      return keys.length ? keys : ["root"];
    }

    function filesOf(section, cat){
      const obj = state.data?.[section] || {};
      const arr = (obj?.[cat] || []).filter(isImage);
      return arr;
    }

    function matchQuery(path, section, cat){
      const q = norm(state.query).trim();
      if(!q) return true;
      const hay = norm([path, section, cat].join(" "));
      return hay.includes(q);
    }

    function el(tag, cls, html){
      const d = document.createElement(tag);
      if(cls) d.className = cls;
      if(html!=null) d.innerHTML = html;
      return d;
    }

    function render(){
      const cards = document.getElementById("cards");
      cards.innerHTML = "";

      ["avatars","icons","photos"].forEach(section=>{
        const card = el("div","card");
        const head = el("div","cardHead");
        const left = el("div");
        const title = section[0].toUpperCase()+section.slice(1);
        const desc = section==="avatars" ? "头像（适合网站头像链接）"
                  : section==="icons" ? "图标（小尺寸 / favicon / UI）"
                  : "照片（展示图 / 背景图）";
        left.appendChild(el("div","title",title));
        left.appendChild(el("div","desc",desc));
        head.appendChild(left);
        card.appendChild(head);

        // 分类 tabs
        const tabs = el("div","tabs scroll");
        const cats = categoriesOf(section);
        if(!state.active[section]) state.active[section] = cats[0] || "root";
        cats.forEach(cat=>{
          const b = el("button","tab"+(cat===state.active[section]?" active":""), cat);
          b.onclick = ()=>{
            state.active[section] = cat;
            render();
          };
          // 如果搜索在用，且该分类下没有任何匹配，仍然显示但可点
          tabs.appendChild(b);
        });
        card.appendChild(tabs);

        const body = el("div","body");
        const gal = el("div","gallery");

        // 只展示当前分类
        const cat = state.active[section] || "root";
        const all = filesOf(section, cat).filter(p=>matchQuery(p, section, cat));

        if(all.length===0){
          gal.appendChild(el("div","empty", state.query ? "没有匹配的图片" : "这个分类还没有图片"));
        }else{
          const items = el("div","items");
          all.slice(0, 48).forEach(path=>{
            const it = el("div","item");
            const img = el("img","thumb");
            img.loading = "lazy";
            img.src = toUrl(path);
            img.alt = path;
            it.appendChild(img);

            const meta = el("div","meta");
            const name = el("div","name", path.split("/").pop());
            meta.appendChild(name);
            it.appendChild(meta);

            it.onclick = ()=> openModal(path);
            items.appendChild(it);
          });
          gal.appendChild(items);
        }

        body.appendChild(gal);
        card.appendChild(body);
        cards.appendChild(card);
      });
    }

    // Modal 预览
    const modal = document.getElementById("modal");
    const modalImg = document.getElementById("modalImg");
    const modalTitle = document.getElementById("modalTitle");
    const copyBtn = document.getElementById("copyBtn");
    const openBtn = document.getElementById("openBtn");
    const closeBtn = document.getElementById("closeBtn");
    let currentPath = null;

    function openModal(path){
      currentPath = path;
      const url = toUrl(path);
      modalImg.src = url;
      modalTitle.textContent = path;
      copyBtn.onclick = ()=> copyText(url);
      openBtn.onclick = ()=> window.open(url, "_blank");
      modal.classList.add("show");
    }
    function closeModal(){
      modal.classList.remove("show");
      modalImg.src = "";
      currentPath = null;
    }
    closeBtn.onclick = closeModal;
    modal.onclick = (e)=>{ if(e.target===modal) closeModal(); };
    window.addEventListener("keydown",(e)=>{ if(e.key==="Escape") closeModal(); });

    // 搜索
    document.getElementById("q").addEventListener("input",(e)=>{
      state.query = e.target.value || "";
      render();
    });

    // Open Repo
    document.getElementById("openRepoBtn").onclick = ()=> window.open(REPO_URL, "_blank");

    // 启动
    (async ()=>{
      try{
        state.data = await loadIndex();
      }catch(e){
        // 没有 index.json 就给一个空壳避免报错
        state.data = {avatars:{},icons:{},photos:{}};
        toast("未找到 index.json（先加 workflow 自动生成）");
      }
      render();
    })();
  </script>
</body>
</html>
